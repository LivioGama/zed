
## CRITICAL: Zero-Reset Mandate

I have NO memory between sessions. My memory resets completely at session start. The Memory Bank in `.memory-bank/` is my ONLY link to previous work. I MUST read it before doing anything else.

---

## Task Start Protocol (MANDATORY - EVERY TASK)

At the start of EVERY task, I MUST:

1. **Read Memory Bank files** (in order):
   - `.memory-bank/02-CURRENT-STATE.md`
   - `.memory-bank/03-CONSTRAINTS.md`
   - `.memory-bank/00-PROJECT-BRIEF.md`

2. **Sync Audit**:
   - Compare the last entry in `.memory-bank/99-CHANGELOG.md` against timestamps of modified source files.
   - If Memory Bank docs are stale relative to code changes, recommend `/update` before proceeding.

3. **Prefix my response** with status indicator:
   - `[Memory Bank: Active]` — If I successfully read the memory bank files
   - `[Memory Bank: Missing]` — If `.memory-bank/` doesn't exist or is empty

4. **Briefly confirm understanding** (1-2 sentences): include the current milestone and the immediate technical objective.
   ```
[Memory Bank: Active] Milestone: Current testing phase. Objective: Validate performance across all relevant dimensions.
   ```

5. **If Memory Bank is missing**: Warn user about potential issues and suggest initialization.

**IMPORTANT**: This protocol applies to EVERY task, not just session start. The status prefix helps the user verify context is loaded correctly.

---

## Session Start Protocol (MANDATORY)

### Step 1: Verify Memory Bank Exists
```bash
ls .memory-bank/
```
If missing → Run **Initialization Protocol** below.

### Step 2: Load Context (in this order)
1. `.memory-bank/02-CURRENT-STATE.md` — What's happening now
2. `.memory-bank/03-CONSTRAINTS.md` — Rules I must follow
3. `.memory-bank/00-PROJECT-BRIEF.md` — If scope questions arise

### Step 3: Confirm Alignment
Summarize to user in 2-3 sentences:
- What was accomplished last session
- Current milestone/blockers
- Immediate next steps

Only proceed after user confirms understanding is correct.

---

## During Session

### Before Any Code Change
1. Check `03-CONSTRAINTS.md` for violations
2. Validate against forbidden patterns
3. Proceed only if compliant

### Architectural Integrity (ADR)
For any significant design shift:
1. Create an ADR in `.memory-bank/context/decisions/`
2. Log the ADR in `99-CHANGELOG.md`

### After Any File Modification
Log immediately to `99-CHANGELOG.md`:
```
[YYYY-MM-DD HH:MM] ACTION: path/to/file - Description
```
Actions: `CREATE`, `MODIFY`, `DELETE`, `RENAME`, `REFACTOR`

### After Milestone Completion
Update `02-CURRENT-STATE.md`:
- Mark completed items
- Update progress percentage
- Add any new blockers or issues

---

## Session End Protocol

When user says "done", "wrap up", "stopping", session is ending, or approaching context limits:

1. **Log session to changelog**:
   ```
   [YYYY-MM-DD HH:MM] SESSION: End - Summary of work done
   ```

2. **Update `02-CURRENT-STATE.md`**:
   - Last Session Summary: What was accomplished
   - Active Milestone: Current progress %
   - Immediate Next Steps: Specific, actionable, with file paths
   - Working Context: Uncommitted thoughts / pending logic needed to continue

3. **Shadow Check**: If this chat history were deleted, confirm `.memory-bank/` is sufficient for a new instance to continue perfectly. If not, update the Memory Bank before ending.

4. **Provide handoff block**: Output a concise next-session handoff (milestone, objective, blockers, next steps, key files).

5. **Confirm handoff**: Tell user what the next session needs to know


---

## Conflict Resolution (Source of Truth Priority)

When information conflicts between files, higher priority wins:

```
1. 00-PROJECT-BRIEF.md   ← HIGHEST (mission/scope)
2. 03-CONSTRAINTS.md     ← Rules override implementation
3. 01-ARCHITECTURE.md    ← Design decisions
4. 02-CURRENT-STATE.md   ← Current status
5. 99-CHANGELOG.md       ← LOWEST (historical record)
```

If conflict found: Update lower-priority file to match higher, log the resolution.

---

## Context Health Checklist

Run this audit if Memory Bank seems stale or inconsistent:

```
[ ] All 6 core files exist in .memory-bank/
[ ] 00-PROJECT-BRIEF.md has mission and ≥1 requirement defined
[ ] 01-ARCHITECTURE.md reflects actual tech stack
[ ] 02-CURRENT-STATE.md updated within current/last session
[ ] 03-CONSTRAINTS.md has ≥1 constraint per category
[ ] 04-WORKFLOWS.md documents primary dev workflow
[ ] 99-CHANGELOG.md has entries for recent file changes
[ ] No conflicts between constraints and implementation
```

If failures found: Fix immediately before proceeding.

---

## Memory Bank Files

| File | Layer | Purpose | Update Frequency |
|------|-------|---------|------------------|
| `00-PROJECT-BRIEF.md` | Foundation | What & Why | Only on scope change |
| `01-ARCHITECTURE.md` | Technical | How | On architectural decisions |
| `02-CURRENT-STATE.md` | Current | Now | Every session |
| `03-CONSTRAINTS.md` | Policies | Rules | When policies change |
| `04-WORKFLOWS.md` | Workflow | Repeatability | When processes change |
| `99-CHANGELOG.md` | History | Past | After every file change |


**Primary Content (Documentation Schema)**
- `00-PROJECT-BRIEF.md`: Core mission, scope, and success criteria
- `01-ARCHITECTURE.md`: Tech stack, design patterns, and component mapping
- `02-CURRENT-STATE.md`: Active focus, milestones, and immediate next steps
- `03-CONSTRAINTS.md`: Hard rules, security standards, and lessons learned
- `04-WORKFLOWS.md`: Build/deploy steps and repetitive task procedures
- `99-CHANGELOG.md`: Chronological audit trail of all project changes

---

## Bootstrap Protocol (`/init`)
- **Existing projects**: Perform a comprehensive codebase scan to generate/populate `.memory-bank/`.
- **Empty projects**: Run a structured interview to define:
  1. Core Mission
  2. Technical Stack
  3. Primary Milestone
  4. Known Constraints

---

## Synchronization Protocol (`/update`)
- Execute a global re-analysis of all project files.
- Re-map architectural patterns and update Memory Bank state files.
- Transition session "Lessons Learned" into permanent rules in `03-CONSTRAINTS.md`.


---

## Initialization Protocol

If `.memory-bank/` does not exist, create it with these files:

```bash
mkdir -p .memory-bank/context/decisions
```

### 00-PROJECT-BRIEF.md
```markdown
# Project Brief

## Mission
[One sentence: what this project does and why]

## Core Requirements
1. [Must-have requirement]
2. [Must-have requirement]
3. [Must-have requirement]

## Success Criteria
- [Measurable outcome that defines success]
- [Measurable outcome that defines success]

## User Experience Targets
- [Key UX goal]
- [Key UX goal]

## Out of Scope
- [Explicit exclusion to prevent scope creep]
- [Explicit exclusion to prevent scope creep]
```

### 01-ARCHITECTURE.md
```markdown
# Architecture

## Tech Stack
| Layer | Technology | Version |
|-------|------------|---------|
| Language | | |
| Framework | | |
| Database | | |
| Testing | | |
| Build | | |

## Directory Structure
[Document key directories and their purposes]

## Design Patterns
- [Pattern in use and why]

## Key Components
- [Component]: [Purpose]

## Integration Points
- [External API/service]
```

### 02-CURRENT-STATE.md
```markdown
# Current State

## Last Updated
[YYYY-MM-DD HH:MM]

## Last Session Summary
No previous session recorded.

## Active Milestone
**[Name]**: [Description]
- Progress: 0%
- Blockers: None
- Target: [Date]

## Immediate Next Steps
1. [ ] Complete project brief
2. [ ] Document architecture
3. [ ] Define constraints
4. [ ] Begin implementation

## Known Issues
| ID | Severity | Description | Status |
|----|----------|-------------|--------|
| - | - | None | - |

## Working Context
Memory Bank initialized. Awaiting project setup.
```

### 03-CONSTRAINTS.md
```markdown
# Constraints

## Technical Constraints
- [Hard limit: e.g., "Must support Node 18+"]

## Security Policies
- No hardcoded secrets or credentials
- All user input must be sanitized
- [Project-specific security rule]

## Code Standards
- [Style guide: e.g., "Follow PEP 8"]
- All public functions require docstrings
- [Project-specific standard]

## Forbidden Patterns
- [Anti-pattern to avoid]
- [Anti-pattern to avoid]

## Pre-Change Validation
Before committing any change:
- [ ] Follows established patterns
- [ ] No constraint violations
- [ ] Security policies maintained
- [ ] Tests pass (if applicable)
```

### 04-WORKFLOWS.md
```markdown
# Workflows

## Development Workflow
1. Read current state from Memory Bank
2. Implement changes
3. Run tests
4. Log changes to changelog
5. Update current state

## Testing
\`\`\`bash
# [Add test command]
\`\`\`

## Build
\`\`\`bash
# [Add build command]
\`\`\`

## Deploy
\`\`\`bash
# [Add deploy command]
\`\`\`

## Common Tasks

### Add Dependency
\`\`\`bash
# [Add command]
\`\`\`

### Run Locally
\`\`\`bash
# [Add command]
\`\`\`
```

### 99-CHANGELOG.md
```markdown
# Changelog

Format: `[YYYY-MM-DD HH:MM] ACTION: path - description`

**Actions**: CREATE, MODIFY, DELETE, RENAME, REFACTOR, SESSION

---

## Entries

[YYYY-MM-DD HH:MM] CREATE: .memory-bank/ - Initialized Memory Bank
```

After creating all files, prompt user to fill in project-specific details.

---

## Project Commands

```bash
# Build
# [TODO: Add build command]

# Test
# [TODO: Add test command]

# Lint
# [TODO: Add lint command]

# Run
# [TODO: Add run command]
```

---

## Project-Specific Constraints

[Add any constraints specific to this project that aren't in 03-CONSTRAINTS.md]

---

## Notes

- Memory Bank uses standard Markdown for human readability
- All timestamps use ISO 8601 format: YYYY-MM-DD HH:MM
- Context window limits: Update current state before approaching limits
- ADRs (Architecture Decision Records) go in `.memory-bank/context/decisions/`
